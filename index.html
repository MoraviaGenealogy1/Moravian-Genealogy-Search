<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moravian Genealogy Search / Moravsk√© genealogick√© vyhled√°v√°n√≠</title>
  <style>
.tab-button {
  padding: 0.5em 1em;
  margin-right: 0.3em;
  border: 1px solid #aaa;
  background-color: #f0f0f0;
  cursor: pointer;
  font-size: 0.9em;
}

.tab-button.active {
  background-color: #dfefff;
  border-color: #66a;
}

    body { font-family: Arial, sans-serif; padding: 2em; max-width: 900px; margin: auto; }
    label, select, input { font-size: 1em; margin: 0.5em 0; display: block; }
    input, select { padding: 0.4em; width: 250px; }
    table { border-collapse: collapse; width: 100%; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: left; }
    th { background: #eee; }
  </style>
</head>
<body>
  <h1>Moravian Genealogy Search / Moravsk√© genealogick√© vyhled√°v√°n√≠</h1>

<div id="homeSection">
  <h2>Welcome to Moravian Genealogy Search</h2>
  <p>Use this tool to search for historical records by surname and region from Moravia.</p>
  <button onclick="startSearch()">Begin Search</button>
</div>


  <div id="searchSection">
<div id="searchSection" style="display: none;">
<div id="tabs" style="margin-bottom: 1em;">
  <button onclick="setTypeFilter('')" class="tab-button active">üìã All</button>
  <button onclick="setTypeFilter('Narozen√≠')" class="tab-button">üçº Births</button>
  <button onclick="setTypeFilter('S≈àatek')" class="tab-button">üíç Marriages</button>
  <button onclick="setTypeFilter('√ömrt√≠')" class="tab-button">‚ö∞Ô∏è Deaths</button>
</div>

  <label for="surname">P≈ô√≠jmen√≠ / Surname:</label>
  <input type="text" id="surname" placeholder="e.g. Nov√°k" oninput="searchRecords()" />

  <label for="region">Farnost / Parish (Region):</label>
  <select id="region" onchange="searchRecords()">
    <option value="">V≈°echny / All</option>
  </select>

  <table id="results">
    <thead>
      <tr>
        <th>Jm√©no / First Name</th>
        <th>P≈ô√≠jmen√≠ / Surname</th>
        <th>Farnost / Parish</th>
        <th>Rok / Year</th>
        <th>Druh z√°znamu / Record Type</th>
        <th>Z√°znam / Record</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

  <script>
let currentTypeFilter = '';
function setTypeFilter(type)
function setTypeFilter(type) {
  currentTypeFilter = type;
  searchRecords();

  // Update tab styles
  document.querySelectorAll(".tab-button").forEach(btn => {
    btn.classList.remove("active");
  });

  const tabButtons = {
    "": "üìã All",
    "Narozen√≠": "üçº Births",
    "S≈àatek": "üíç Marriages",
    "√ömrt√≠": "‚ö∞Ô∏è Deaths"
  };

  // Re-add 'active' to the matching button
  document.querySelectorAll(".tab-button").forEach(btn => {
    if (btn.textContent.includes(tabButtons[type])) {
      btn.classList.add("active");
    }
  });
}
 {
  currentTypeFilter = type;
  searchRecords();
}
function normalizeString(str) {
  return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
}

function startSearch() {
  document.getElementById("homeSection").style.display = "none";
  document.getElementById("searchSection").style.display = "block";
  setTypeFilter(""); // Reset to show all types
}

    let records = [];

    // Load records.json and initialize
    async function loadData() {
      try {
        const response = await fetch('records.json');
        if (!response.ok) throw new Error('Network response was not ok');
        records = await response.json();

        populateRegions();
      } catch (error) {
        alert('Failed to load records.json: ' + error.message);
      }
    }

    // Populate the region dropdown dynamically
    function populateRegions() {
      const regionSelect = document.getElementById('region');
      const regions = [...new Set(records.map(r => r.parish))].sort();

      for (const region of regions) {
        const option = document.createElement('option');
        option.value = region;
        option.textContent = region;
        regionSelect.appendChild(option);
      }
    }

function searchRecords() {
  const surnameQuery = document.getElementById('surname').value.toLowerCase();
  const regionQuery = document.getElementById('region').value;
  const tbody = document.querySelector('#results tbody');
  tbody.innerHTML = '';

const filtered = records.filter(record => {
  const surnameMatch = normalizeString(record.surname).includes(normalizeString(surnameQuery));
  const regionMatch = regionQuery === '' || record.parish === regionQuery;
  const typeMatch = currentTypeFilter === '' || record.type === currentTypeFilter;
  return surnameMatch && regionMatch && typeMatch;
});

  // Sort filtered records by year ascending
  filtered.sort((a, b) => Number(a.year) - Number(b.year));

  if (filtered.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6">≈Ω√°dn√© v√Ωsledky nenalezeny / No results found.</td></tr>';
    return;
  }

  for (const record of filtered) {
    const row = `
      <tr>
        <td>${record.firstName}</td>
        <td>${record.surname}</td>
        <td>${record.parish}</td>
        <td>${record.year}</td>
        <td>${record.type}</td>
        <td><a href="${record.link}" target="_blank" rel="noopener noreferrer">Zobrazit / View</a></td>
      </tr>`;
    tbody.insertAdjacentHTML('beforeend', row);
  }
}

    window.onload = loadData;
  </script>
</body>
</html>
