<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moravian Genealogy Search / Moravské genealogické vyhledávání</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2em; max-width: 900px; margin: auto; }
    label, select, input { font-size: 1em; margin: 0.5em 0; display: block; }
    input, select { padding: 0.4em; width: 250px; }
    table { border-collapse: collapse; width: 100%; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: left; }
    th { background: #eee; }
  </style>
</head>
<body>
  <h1>Moravian Genealogy Search / Moravské genealogické vyhledávání</h1>

  <label for="surname">Příjmení / Surname:</label>
  <input type="text" id="surname" placeholder="e.g. Novák" oninput="searchRecords()" />

  <label for="region">Farnost / Parish (Region):</label>
  <select id="region" onchange="searchRecords()">
    <option value="">Všechny / All</option>
  </select>

  <table id="results">
    <thead>
      <tr>
        <th>Jméno / First Name</th>
        <th>Příjmení / Surname</th>
        <th>Farnost / Parish</th>
        <th>Rok / Year</th>
        <th>Druh záznamu / Record Type</th>
        <th>Záznam / Record</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let records = [];

    // Load records.json and initialize
    async function loadData() {
      try {
        const response = await fetch('records.json');
        if (!response.ok) throw new Error('Network response was not ok');
        records = await response.json();

        populateRegions();
        searchRecords();
      } catch (error) {
        alert('Failed to load records.json: ' + error.message);
      }
    }

    // Populate the region dropdown dynamically
    function populateRegions() {
      const regionSelect = document.getElementById('region');
      const regions = [...new Set(records.map(r => r.parish))].sort();

      for (const region of regions) {
        const option = document.createElement('option');
        option.value = region;
        option.textContent = region;
        regionSelect.appendChild(option);
      }
    }

function searchRecords() {
  const surnameQuery = document.getElementById('surname').value.toLowerCase();
  const regionQuery = document.getElementById('region').value;
  const tbody = document.querySelector('#results tbody');
  tbody.innerHTML = '';

  const filtered = records.filter(record => {
    const surnameMatch = record.surname.toLowerCase().includes(surnameQuery);
    const regionMatch = regionQuery === '' || record.parish === regionQuery;
    return surnameMatch && regionMatch;
  });

  // Sort filtered records by year ascending
  filtered.sort((a, b) => a.year - b.year);

  if (filtered.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6">Žádné výsledky nenalezeny / No results found.</td></tr>';
    return;
  }

  for (const record of filtered) {
    const row = `
      <tr>
        <td>${record.firstName}</td>
        <td>${record.surname}</td>
        <td>${record.parish}</td>
        <td>${record.year}</td>
        <td>${record.type}</td>
        <td><a href="${record.link}" target="_blank" rel="noopener noreferrer">Zobrazit / View</a></td>
      </tr>`;
    tbody.insertAdjacentHTML('beforeend', row);
  }
}

    window.onload = loadData;
  </script>
</body>
</html>
